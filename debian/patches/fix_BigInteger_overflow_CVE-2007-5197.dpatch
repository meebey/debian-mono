#! /bin/sh /usr/share/dpatch/dpatch-run
## fix_BigInteger_overflow_CVE-2007-5197.dpatch by Mirco Bauer <meebey@debian.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
diff -urNad mono-1.2.2.1~/mcs/class/Mono.Security/Mono.Math/BigInteger.cs mono-1.2.2.1/mcs/class/Mono.Security/Mono.Math/BigInteger.cs
--- mono-1.2.2.1~/mcs/class/Mono.Security/Mono.Math/BigInteger.cs	2006-04-14 19:51:24.000000000 +0200
+++ mono-1.2.2.1/mcs/class/Mono.Security/Mono.Math/BigInteger.cs	2007-10-28 22:42:47.000000000 +0100
@@ -1574,7 +1574,7 @@
 						uint j = 1;
 
 						// Multiply and add
-						for (; j < m.length; j++) {
+						for (; j < m.length && j < A.length; j++) {
 							c += (ulong)u_i * (ulong)*(mP++) + *(aSP++);
 							*(aDP++) = (uint)c;
 							c >>= 32;
diff -urNad mono-1.2.2.1~/mcs/class/corlib/Mono.Math/BigInteger.cs mono-1.2.2.1/mcs/class/corlib/Mono.Math/BigInteger.cs
--- mono-1.2.2.1~/mcs/class/corlib/Mono.Math/BigInteger.cs	2006-04-14 19:50:35.000000000 +0200
+++ mono-1.2.2.1/mcs/class/corlib/Mono.Math/BigInteger.cs	2007-10-28 22:42:15.000000000 +0100
@@ -1574,7 +1574,7 @@
 						uint j = 1;
 
 						// Multiply and add
-						for (; j < m.length; j++) {
+						for (; j < m.length && j < A.length; j++) {
 							c += (ulong)u_i * (ulong)*(mP++) + *(aSP++);
 							*(aDP++) = (uint)c;
 							c >>= 32;
